# .github/workflows/run_main_py.yml

# 工作流名称
name: Run Python Script on Schedule

on:
  # 定时触发器：每分钟执行一次
  # 注意：GitHub Actions 的实际最小间隔约为 5 分钟
  schedule:
    - cron: '* * * * *'

  # 手动触发器：方便在 Actions 页面手动运行进行测试
  #workflow_dispatch:

jobs:
  # 任务 ID
  run-python-script:
    # 运行环境
    runs-on: ubuntu-latest

    steps:
      # 第一步：检出你的代码库，让 workflow 可以访问 main.py
      - name: Checkout repository
        uses: actions/checkout@v4

      # 第二步：设置 Python 环境
      # 你可以根据你的项目需要更改 python-version，例如 '3.8', '3.11' 等
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 第三步：安装脚本依赖项
      # 这个步骤会检查是否存在 requirements.txt 文件，如果存在，则安装其中的库
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      # 第四步：执行你的 Python 脚本
      - name: Execute main.py script
        run: python main.py
